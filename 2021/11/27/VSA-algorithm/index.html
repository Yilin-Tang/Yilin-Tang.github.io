<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>VSA_algorithm | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="算法背景：k-means算法k-means算法步骤：  初始化：随机找k个中心 Partitioning：将N个点分配到它距离最近的中心 Fitting：根据分配结果，计算每一类的平均值作为新的中心 Repeat：从2开始重复，迭代一定步数后停止  k-means算法实际上优化的损失函数是 $$\sum_{i&#x3D;1}^{k}\sum_{X_j\in \mathcal{R}_i} |X_j-c_i|^">
<meta property="og:type" content="article">
<meta property="og:title" content="VSA_algorithm">
<meta property="og:url" content="http://example.com/2021/11/27/VSA-algorithm/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="算法背景：k-means算法k-means算法步骤：  初始化：随机找k个中心 Partitioning：将N个点分配到它距离最近的中心 Fitting：根据分配结果，计算每一类的平均值作为新的中心 Repeat：从2开始重复，迭代一定步数后停止  k-means算法实际上优化的损失函数是 $$\sum_{i&#x3D;1}^{k}\sum_{X_j\in \mathcal{R}_i} |X_j-c_i|^">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/b7c5585d-68c6-4eb6-9cd2-794b2d62e422/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45/20211127/us-west-2/s3/aws4_request&X-Amz-Date=20211127T114804Z&X-Amz-Expires=86400&X-Amz-Signature=e7caed11025d4e8b874d100ca4864cf467ca3d8eb88fb24e94eb02d89cbdbbf2&X-Amz-SignedHeaders=host&response-content-disposition=attachment;%20filename%20=%22Untitled.png%22&x-id=GetObject">
<meta property="article:published_time" content="2021-11-27T11:15:34.000Z">
<meta property="article:modified_time" content="2021-11-27T11:48:47.160Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/b7c5585d-68c6-4eb6-9cd2-794b2d62e422/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45/20211127/us-west-2/s3/aws4_request&X-Amz-Date=20211127T114804Z&X-Amz-Expires=86400&X-Amz-Signature=e7caed11025d4e8b874d100ca4864cf467ca3d8eb88fb24e94eb02d89cbdbbf2&X-Amz-SignedHeaders=host&response-content-disposition=attachment;%20filename%20=%22Untitled.png%22&x-id=GetObject">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-VSA-algorithm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/27/VSA-algorithm/" class="article-date">
  <time datetime="2021-11-27T11:15:34.000Z" itemprop="datePublished">2021-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      VSA_algorithm
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="算法背景：k-means算法"><a href="#算法背景：k-means算法" class="headerlink" title="算法背景：k-means算法"></a>算法背景：k-means算法</h2><p>k-means算法步骤：</p>
<ol>
<li>初始化：随机找k个中心</li>
<li>Partitioning：将N个点分配到它距离最近的中心</li>
<li>Fitting：根据分配结果，计算每一类的平均值作为新的中心</li>
<li>Repeat：从2开始重复，迭代一定步数后停止</li>
</ol>
<p>k-means算法实际上优化的损失函数是</p>
<p>$$\sum_{i=1}^{k}\sum_{X_j\in \mathcal{R}_i} |X_j-c_i|^2$$</p>
<p>其中$k$是分类数，$\mathcal{R}_i$是划分的区域，$c_i$是$\mathcal{R}_i$的中心，$X_j$是点。</p>
<p>VSA受到k-means算法的启发，将曲面简化过程分为<strong>Geometry Partitioning</strong>和<strong>Proxy Fitting</strong>两部分，对应于k-means算法中的Partitioning和Fitting。但曲面简化显然不是对三角形做简单聚类，三角形地分类需要保留几何信息，所以需要用到不同的损失函数，也就是$\mathcal{L}^2$或$\mathcal{L}^{2,1}$指标。</p>
<h2 id="VSA算法的核心概念"><a href="#VSA算法的核心概念" class="headerlink" title="VSA算法的核心概念"></a>VSA算法的核心概念</h2><p>Proxy：向量对$P=(X,\mathbf{N})$，其中$X$是点的坐标，$\mathbf{N}$是法向量。可以将$P$想象为过点$X$、法向量为$\mathbf{N}$的平面</p>
<p>$\mathcal{L}^2$：$\mathcal{L}^{2}\left(\mathcal{R}<em>{i}, P</em>{i}\right)=\iint_{x \in \mathcal{R}<em>{i}}\left|x-\Pi</em>{i}(x)\right|^{2} d x$</p>
<p>$\mathcal{L}^{2,1}$：$\mathcal{L}^{2,1}\left(\mathcal{R}<em>{i}, P</em>{i}\right)=\iint_{x \in \mathcal{R}_{i}}\left|\mathbf{n}(x)-\mathbf{n}_i \right| d x$</p>
<h2 id="VSA算法描述："><a href="#VSA算法描述：" class="headerlink" title="VSA算法描述："></a>VSA算法描述：</h2><h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><p>$\mathcal{S}$：输入的曲面</p>
<p>$T_j$：$\mathcal{S}$中的三角形</p>
<p>$\mathcal{R}$：当前分割</p>
<p>$k$：分割的区域个数</p>
<p>$\mathcal{R}_i$：$\mathcal{R}$的第i个区域</p>
<p>$P_i=(X_i,\mathbf{N}_i)$：$\mathcal{R}_i$对应的Proxy</p>
<p>$E$：$\mathcal{L}^2$或$\mathcal{L}^{2,1}$指标的一种</p>
<h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ol>
<li>初始化（Initial Seeding）： 随机确定$\mathcal{S}$上的$k$个种子三角形$ST_i(i=1,\dots,k)$，对$ST_i$分配$P_i=(X_i,\mathbf{N}_i)$，其中$X_i$是$T_i$的重心坐标，$\mathbf{N}_i$是$T_i$的法向量。</li>
<li>Distortion-minimizing Flooding：从种子三角形”生长“出分割区域，即从$ST_i$出发，将$\mathcal{S}$的所有三角形划分到$ST_i$对应的Proxy<ol>
<li>设置一个全局最小优先队列，队列元素为$(T_j,P_i)$，优先度为$E(T_j,P_i)$。同时给每个三角形$T_j$设置一个**被分配到哪个$P_i$**的标识。$ST_i$分配给$P_i$。</li>
<li>初始化队列：$ST_i$相邻的三个三角形$(T_{ij},P_i)(j=0,1,2)(i=1,\dots,k)$入队。</li>
<li>出队入队循环：元素$(T_j,P_i)$出队，若$T_j$还未分配给Proxy，则将$T_j$分配给$P_i$，并将$T_j$的最多两个的未分配的相邻三角形与$P_i$组成元素入队；若$T_j$已分配给Proxy，则不做任何操作，下一个元素出队。优先队列为空时循环停止。</li>
<li>得到新的分割$\mathcal{R}$</li>
</ol>
</li>
<li>Proxy Fitting：得到新的$\mathcal{R}$后，更新$P_i$使其更好地表示新区域$R_i$<ol>
<li>若$E=\mathcal{L}^2$，则$X_i$是$\mathcal{R}_i$中所有三角形的重心坐标的加权平均，权重是三角形的面积；$\mathbf{N}_i$是$\mathcal{R}_i$的协方差矩阵的最小特征值的特征向量。</li>
<li>若$E=\mathcal{L}^{2,1}$，则$\mathbf{N}_i$是$\mathcal{R}_i$$X_i$是$\mathcal{R}_i$中所有三角形的重心坐标的加权平均，权重是三角形的面积；$X_i$与$L^{2,1}$无关，这里取为$\mathcal{L}^2$的$X_i$。</li>
</ol>
</li>
<li>确定新的中心：根据更新后的$P_i$确定新的种子三角形$ST_i(i=1,\dots,k)$<ol>
<li>遍历$\mathcal{R}_i$的所有三角形$T_j$并计算$E(T_j,P_i)$，找到使得$E(T_j,P_i)$最小的三角形，就是新的种子三角形$ST_i$</li>
<li>将$ST_i$分配给$P_i$，同时抹除其余三角形与Proxy的分配关系。</li>
<li>返回步骤2，直到迭代了给定的次数。</li>
</ol>
</li>
</ol>
<h3 id="计算公式："><a href="#计算公式：" class="headerlink" title="计算公式："></a>计算公式：</h3><ul>
<li>重心坐标：设三角形$T_j$的三个顶点为$v_1,v_2,v_3$，则$T_j$的重心坐标$g_j=\frac{v_1+v_2+v_3}{3}$</li>
<li>计算三角形$T_j$与$P_i$的$E(T_j,P_i)$：<ul>
<li>$E=\mathcal{L}^2$：$d_1,d_2,d_3$分别是$v_1,v_2,v_3$到$P_i$的垂直距离  $$\mathcal{L}^2(T_j,P_i)=\frac16(d_1^2+d_2^2+d_3^2+d_1d_2+d_1d_3+d_2d_3)|T_j|$$</li>
<li>$E=\mathcal{L}^{2,1}$：$\mathbf{n}_j$是$T_j$的法向量  $$\mathcal{L}^{2,1}(T_j,P_i)=|\mathbf{n}_i-\mathbf{N}_i|^2|T_j|$$</li>
</ul>
</li>
<li>计算区域$\mathcal{R}_i$的最佳Proxy<ul>
<li>$E=\mathcal{L}^2$：  $$<br>  X_{i}=\left(\sum_{T_{i} \in \mathcal{R}<em>{i}} g</em>{i}\left|T_{i}\right|\right) /\left(\sum_{T_{i} \in \mathcal{R}{i}}\left|T_{i}\right|\right)<br>  $$  $$\mathbf{N}<em>i=\begin{array}{l}<br>  \sum</em>{T_{i} \in \mathcal{R}{i}}\left(\frac{2\left|T{i}\right|}{72} M_{i}\left(\begin{array}{ccc}<br>  10 &amp; 7 &amp; 0 \<br>  7 &amp; 10 &amp; 0 \<br>  0 &amp; 0 &amp; 0<br>  \end{array}\right) M_{i}^{t}+\left|T_{i}\right| g_{i} g_{i}{ }^{t}\right)-\left[\sum_{i}\left|T_{i}\right|\right] X_{i} X_{i}^{t} \quad<br>  \text { where } M_{i}=\left(\frac{u_{2}-v_{1}}{v_{3}-v_{1}}\right) .<br>  \end{array}<br>  $$</li>
<li>$E=\mathcal{L}^{2,1}$：$X_i$同上  $$\mathbf{N}<em>i=\sum</em>{T_{i} \in \mathcal{R}}|T_i|\mathbf{n}_i$$</li>
</ul>
</li>
</ul>
<h1 id="提取网格"><a href="#提取网格" class="headerlink" title="提取网格"></a>提取网格</h1><p>VSA算法到此为止得到了分割$\mathcal{R}$和$k$个拟合好的$P_i=(X_i,\mathbf{N}_i)$，但还没有得到一个有效的网格表示。下面介绍如何提取网格。</p>
<h3 id="Anchor-Vertices"><a href="#Anchor-Vertices" class="headerlink" title="Anchor Vertices"></a>Anchor Vertices</h3><p>现在已经找到了近似得最好的Proxies，而Proxies可以看作近似平面，接下来就要在Proxies的平面相交处添加顶点。</p>
<ol>
<li>在$<del>\mathcal{S}</del>$的顶点中寻找连接3个或以上区域的顶点，这些顶点会在新网格中生成称为<em><strong>anchor vertex</strong></em>的顶点</li>
<li>计算这些顶点在它连接的所有$P_j$上的投影，并取这些投影的平均值，这就是该顶点对应的anchor vertex（可理解为原顶点在新网格中的坐标）</li>
<li>为了保证每个区域至少有一个多边形，需要检查区域$\mathcal{R}_i$的边界是否有至少三个anchor vertex，不够的话则需要添加。</li>
</ol>
<h3 id="Edge-Extraction"><a href="#Edge-Extraction" class="headerlink" title="Edge Extraction"></a>Edge Extraction</h3><p>每个anchor vertex与原顶点是对应的，可以通过访问区域的边界将anchor vertices连接起来。但这种方法过于粗糙，会造成几何结构的不精确，所以提出了<strong>弧长细分递归算法</strong>。</p>
<p>设$\mathbf{a}$和$\mathbf{b}$是两个anchor vertex，连接它们的边分开了$P_i$和$P_j$</p>
<ol>
<li>访问$\mathbf{a}$和$\mathbf{b}$之间的区域边界上的原顶点，找到使得点到边$(\mathbf{a},\mathbf{b})$的距离$d$最大的点$\mathbf{c}$。</li>
<li>计算条件 $$\text{cond}=d\cdot\frac{\sin(\mathbf{N}_i,\mathbf{N}_j)}{|(\mathbf{a},\mathbf{b})|}$$ 若$\text{cond}$小于某个阈值，则不进行任何操作 若$\text{cond}$大于某个阈值，则$\mathbf{c}$处添加一个anchor vertex，然后在边$(\mathbf{a},\mathbf{c})$和边$(\mathbf{c},\mathbf{b})$重复执行以上操作，直到$\text{cond}$小于阈值。</li>
</ol>
<h3 id="Triangulation"><a href="#Triangulation" class="headerlink" title="Triangulation"></a>Triangulation</h3><p>经过上面的步骤后，已经得到了一个多边形网格，但是还无法保证这些多边形是平的或者凸的，因此还需要做三角划分（OpenGL只能渲染三角形网格）。这一过程对每个区域用一个伪CDT（Constrained Delaunay Triangulation）实现，Constrained的意思是保证连接anchor vertices的边在最终生成的三角形网格中。</p>
<ol>
<li>给一个区域的多边形顶点（也就是anchor vertices）不同的颜色</li>
<li>遍历该区域<strong>边界</strong>的所有原顶点，顶点着上与之最近的anchor vertex的颜色。</li>
<li>遍历该区域<strong>内</strong>的所有原顶点，同样地，顶点着上与之最近的anchor vertex的颜色。</li>
<li>若输入曲面$<del>\mathcal{S}</del>$的三角形的三个顶点有三种不同颜色，则将这三种颜色对应的anchor vertices连接起来生成一个三角形，这些生成的三角形组成最终的三角形网格。</li>
</ol>
<p>若只是希望得到三角形网格，则VSA算法到这里就完成了。接下来还可以去掉三角形网格中一些冗余的边，得到更为简洁的多边形网格。</p>
<p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/b7c5585d-68c6-4eb6-9cd2-794b2d62e422/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45/20211127/us-west-2/s3/aws4_request&X-Amz-Date=20211127T114804Z&X-Amz-Expires=86400&X-Amz-Signature=e7caed11025d4e8b874d100ca4864cf467ca3d8eb88fb24e94eb02d89cbdbbf2&X-Amz-SignedHeaders=host&response-content-disposition=attachment;%20filename%20=%22Untitled.png%22&x-id=GetObject" alt="meshing"></p>
<p>左边和中间是着色的示意图，中间的灰色三角形就是三个顶点有三种颜色的三角形。右上是最终的三角形网格，右下是去掉三角形网格的一些边后的多边形网格。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/27/VSA-algorithm/" data-id="ckwhqu06u0001lkup74iwbogf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/11/27/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/27/VSA-algorithm/">VSA_algorithm</a>
          </li>
        
          <li>
            <a href="/2021/11/27/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>